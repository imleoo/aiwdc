<!-- Visitor Counter -->
<div class="visitor-counter">
    <div class="counter-item">
        <span class="counter-icon">üëÅÔ∏è</span>
        <span class="counter-label">Page Views:</span>
        <span id="page-views" class="counter-number">Loading...</span>
    </div>
    <div class="counter-item">
        <span class="counter-icon">üë•</span>
        <span class="counter-label">Visitors:</span>
        <span id="unique-visitors" class="counter-number">Loading...</span>
    </div>
    <div class="counter-item">
        <span class="counter-icon">üìÖ</span>
        <span class="counter-label">Last Visit:</span>
        <span id="last-visit" class="counter-date">Never</span>
    </div>
</div>

<style>
.visitor-counter {
    display: flex;
    gap: 20px;
    padding: 20px;
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    margin: 30px auto;
    font-family: var(--font-sans);
    backdrop-filter: blur(10px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
    max-width: 800px;
    justify-content: center;
}

.counter-item {
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 12px;
    color: var(--text-secondary);
}

.counter-icon {
    font-size: 14px;
    opacity: 0.8;
}

.counter-label {
    color: var(--text-secondary);
    font-weight: 500;
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.counter-number {
    color: var(--connection-color);
    font-weight: 700;
    font-size: 14px;
    font-family: var(--font-mono);
    min-width: 60px;
    text-align: center;
    background: rgba(99, 102, 241, 0.1);
    padding: 4px 8px;
    border-radius: 6px;
    border: 1px solid rgba(99, 102, 241, 0.2);
}

.counter-date {
    color: var(--text-secondary);
    font-size: 10px;
    font-style: italic;
    opacity: 0.8;
}

@media (max-width: 768px) {
    .visitor-counter {
        flex-direction: column;
        gap: 15px;
        padding: 15px;
        margin: 20px 0;
    }

    .counter-item {
        justify-content: space-between;
        align-items: center;
    }

    .counter-number {
        font-size: 14px;
        min-width: 50px;
        padding: 3px 6px;
    }
}
</style>

<script>
// Visitor Counter Implementation
class VisitorCounter {
    constructor() {
        this.config = {
            // Enable/disable API tracking
            useApi: true,

            // Counter.dev configuration
            counterDev: {
                enabled: true,
                scriptUrl: 'https://cdn.counter.dev/script.js',
                id: 'be9d5b6f-bf5b-4ac5-900c-414f31639aa0',
                utcoffset: '8'
            },

            // Local storage keys
            storageKeys: {
                pageViews: 'aiwdc_page_views',
                uniqueVisitors: 'aiwdc_unique_visitors',
                lastVisit: 'aiwdc_last_visit',
                visitorId: 'aiwdc_visitor_id'
            },

            // Display formatting
            dateFormat: {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            }
        };

        this.init();
    }

    async init() {
        // Generate or get visitor ID
        this.visitorId = this.getVisitorId();

        // Initialize Counter.dev
        this.initializeCounterDev();

        // Track page view
        await this.trackPageView();

        // Update displays
        this.updateDisplays();

        // Save visit time
        this.saveVisitTime();
    }

    getVisitorId() {
        let visitorId = localStorage.getItem(this.config.storageKeys.visitorId);
        if (!visitorId) {
            visitorId = this.generateVisitorId();
            localStorage.setItem(this.config.storageKeys.visitorId, visitorId);
        }
        return visitorId;
    }

    generateVisitorId() {
        return 'visitor_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
    }

  initializeCounterDev() {
        if (this.config.counterDev.enabled) {
            // Create Counter.dev script element
            const script = document.createElement('script');
            script.src = this.config.counterDev.scriptUrl;
            script.setAttribute('data-id', this.config.counterDev.id);
            script.setAttribute('data-utcoffset', this.config.counterDev.utcoffset);
            script.async = true;

            // Add script to head
            document.head.appendChild(script);

            console.log('Counter.dev initialized with ID:', this.config.counterDev.id);
        }
    }

    async trackPageView() {
        // Update local storage
        const currentViews = parseInt(localStorage.getItem(this.config.storageKeys.pageViews) || '0');
        const newViews = currentViews + 1;
        localStorage.setItem(this.config.storageKeys.pageViews, newViews.toString());

        // Track unique visitor (first visit today)
        const lastVisit = localStorage.getItem(this.config.storageKeys.lastVisit);
        const today = new Date().toDateString();
        const isFirstVisitToday = !lastVisit || new Date(lastVisit).toDateString() !== today;

        if (isFirstVisitToday) {
            const currentVisitors = parseInt(localStorage.getItem(this.config.storageKeys.uniqueVisitors) || '0');
            const newVisitors = currentVisitors + 1;
            localStorage.setItem(this.config.storageKeys.uniqueVisitors, newVisitors.toString());
        }

        // If API is enabled, try to update external counters
        if (this.config.useApi) {
            try {
                await this.updateApiCounters(isFirstVisitToday);
            } catch (error) {
                console.log('API counter update failed:', error);
            }
        }
    }

    async updateApiCounters(isUniqueVisitor) {
        // Counter.dev is already initialized via script tag
        // No need for manual API calls as Counter.dev handles tracking automatically

        // Google Analytics event tracking
        this.trackWithGoogleAnalytics(isUniqueVisitor);

        console.log('Counter.dev tracking active');
        console.log('Unique visit:', isUniqueVisitor);
    }

    async trackWithFirebase(isUniqueVisitor) {
        // Optional: Firebase Realtime Database integration
        // You'll need to set up Firebase and add the config
        try {
            const firebaseData = {
                timestamp: new Date().toISOString(),
                page: window.location.pathname,
                userAgent: navigator.userAgent,
                visitorId: this.visitorId,
                isUniqueVisitor: isUniqueVisitor
            };

            // Replace with your Firebase database URL
            const firebaseUrl = 'https://your-project-default-rtdb.firebaseio.com/visitors.json';

            // Uncomment and configure Firebase to use this
            // await fetch(firebaseUrl, {
            //     method: 'POST',
            //     headers: { 'Content-Type': 'application/json' },
            //     body: JSON.stringify(firebaseData)
            // });
        } catch (error) {
            console.log('Firebase tracking not configured');
        }
    }

    trackWithGoogleAnalytics(isUniqueVisitor) {
        // Track visitor counter events with Google Analytics
        if (typeof gtag !== 'undefined') {
            gtag('event', 'page_view_counter', {
                'event_category': 'visitor_stats',
                'event_label': 'Page View',
                'value': 1
            });

            if (isUniqueVisitor) {
                gtag('event', 'unique_visitor_counter', {
                    'event_category': 'visitor_stats',
                    'event_label': 'Unique Visitor',
                    'value': 1
                });
            }
        }
    }

    updateDisplays() {
        // Update page views
        const pageViews = localStorage.getItem(this.config.storageKeys.pageViews) || '0';
        const pageViewsElement = document.getElementById('page-views');
        if (pageViewsElement) {
            pageViewsElement.textContent = this.formatNumber(parseInt(pageViews));
        }

        // Update unique visitors
        const uniqueVisitors = localStorage.getItem(this.config.storageKeys.uniqueVisitors) || '0';
        const uniqueVisitorsElement = document.getElementById('unique-visitors');
        if (uniqueVisitorsElement) {
            uniqueVisitorsElement.textContent = this.formatNumber(parseInt(uniqueVisitors));
        }

        // Update last visit
        const lastVisit = localStorage.getItem(this.config.storageKeys.lastVisit);
        const lastVisitElement = document.getElementById('last-visit');
        if (lastVisitElement) {
            if (lastVisit) {
                const visitDate = new Date(lastVisit);
                lastVisitElement.textContent = visitDate.toLocaleDateString('en-US', this.config.dateFormat);
            } else {
                lastVisitElement.textContent = 'First visit';
            }
        }
    }

    saveVisitTime() {
        localStorage.setItem(this.config.storageKeys.lastVisit, new Date().toISOString());
    }

    formatNumber(num) {
        if (num >= 1000000) {
            return (num / 1000000).toFixed(1) + 'M';
        } else if (num >= 1000) {
            return (num / 1000).toFixed(1) + 'K';
        }
        return num.toString();
    }

    // Method to get statistics
    getStats() {
        return {
            pageViews: parseInt(localStorage.getItem(this.config.storageKeys.pageViews) || '0'),
            uniqueVisitors: parseInt(localStorage.getItem(this.config.storageKeys.uniqueVisitors) || '0'),
            lastVisit: localStorage.getItem(this.config.storageKeys.lastVisit),
            visitorId: this.visitorId
        };
    }

    // Method to reset statistics (for development)
    resetStats() {
        Object.values(this.config.storageKeys).forEach(key => {
            localStorage.removeItem(key);
        });
        this.init();
    }
}

// Initialize visitor counter when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    window.visitorCounter = new VisitorCounter();

    // Make reset function available globally (for development)
    window.resetVisitorCounter = function() {
        if (confirm('Are you sure you want to reset visitor statistics?')) {
            window.visitorCounter.resetStats();
        }
    };

    // Log stats for debugging
    console.log('Visitor Counter initialized');
    console.log('Current stats:', window.visitorCounter.getStats());
});

// Export for module usage
if (typeof module !== 'undefined' && module.exports) {
    module.exports = VisitorCounter;
}
</script>